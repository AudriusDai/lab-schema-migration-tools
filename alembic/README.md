# alembic
## Startup commands

```
docker-compose up --build
python3 -m venv env
. env/bin/activate
python3 -m pip install -r requirements.txt
```

## Basic usage
Create a version with message:
```
cd migrator-src
alembic revision -m "create account table"
```

Versions are referenced via `down_revision` variable.

Can manually add some commands to `upgrade` or `downgrade` methods.

Run migrations:
```
alembic upgrade head
```

Table was created via scripts. Also there is additional table `alembic_version` to track short-keys of the executed version scripts.

## Autogenerated usage
Need to modify our env.py to link Base model metadata. It should autogenerate by comparing the models afterwards.

Check `app/model.py` and `env.py` for how it's mapped. 

Execute commands to generate script & run migrations:
```
alembic revision --autogenerate -m "Added account table"
alembic upgrade head
```

## Downgrade
Execute command to downgrade just one version back:
```
alembic downgrade -1
```

## Helping notes
```
pip freeze > requirements.txt
```
Source of docs https://alembic.sqlalchemy.org/en/latest/front.html

How to set sqlalchemy.url from env variables https://stackoverflow.com/questions/37890284/ini-file-load-environment-variable